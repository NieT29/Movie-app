<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css"
          integrity="sha512-vKMx8UnXk60zUwyUnUPM3HbQo8QfmNx7+ltw8Pm5zLusl1XIfwcxo8DbWCqMGKaWeNxWA8yrx5v3SaVpMvR3CA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<th:block th:replace="~{/web/fragments/header :: header}"></th:block>


<section >
    <div class="container bg-ct p-5 container border-top border-secondary border-opacity-50 bg-ct">
        <div class=" d-flex justify-content-center align-items-center flex-column px-4 mx-auto">
            <div class="card-register d-flex flex-column justify-content-around">
                <h3 class="mb-0 mt-2 text-white text-center">Đăng ký</h3>
                <form id="form-register">
                    <div class="mb-4 form-group">
                        <label for="userName" class="form-label text-white">Tên</label>
                        <input type="text" class="form-control" id="userName" name="userName"/>
                    </div>
                    <div class="mb-4 form-group">
                        <label for="email" class="form-label text-white">Email</label>
                        <input type="email" class="form-control" id="email" name="email"/>
                    </div>
                    <div class="mb-4 form-group">
                        <label for="password" class="form-label text-white">Mật khẩu</label>
                        <input type="password" class="form-control" id="password" name="password"/>
                    </div>
                    <div class="mb-4 form-group">
                        <label for="confirmPassword" class="form-label text-white">Nhập lại mật khẩu</label>
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"/>
                    </div>
                    <div class="mb-5 d-flex justify-content-between">
                        <button type="submit" class="btn btn-secondary" id="btn-register">Đăng ký</button>
                        <button type="button" class="btn btn-secondary" id="btn-login">
                            <a th:href="@{/dang-nhap}" class="nav-link text-white">Đăng nhập?</a>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<th:block th:replace="~{/web/fragments/footer :: footer}"></th:block>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"
        integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/jquery.validate.min.js"
        integrity="sha512-WMEKGZ7L5LWgaPeJtw9MBM4i5w5OSBlSjTjCtSnvFJGSVD26gE5+Td12qN5pvWXhuWaWcVwF++F7aqu9cvqP0A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/additional-methods.min.js"
        integrity="sha512-TiQST7x/0aMjgVTcep29gi+q5Lk5gVTUPE9XgN0g96rwtjEjLpod4mlBRKWHeBcvGBAEvJBmfDqh2hfMMmg+5A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://kit.fontawesome.com/d898046858.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="/js/main.js"></script>
<script>
    $('#form-register').validate({
        rules: {
            userName: {
                required: true,
            },
            email: {
                required: true,
                email: true,
            },
            password: {
                required: true,
            },
            confirmPassword: {
                required: true,
                equalTo: '[name="password"]'
            }
        },
        messages: {
            userName: {
                required: "Tên không được để trống",
            },
            email: {
                required: "Email không được để trống",
                email: "Email không đúng định dạng"
            },
            password: {
                required: "Mật khẩu không được để trống",
            },
            confirmPassword: {
                required: "Mật khẩu không được để trống",
                equalTo: "Mật khẩu không khớp"
            }
        },
        errorElement: 'span',
        errorPlacement: function (error, element) {
            error.addClass('invalid-feedback');
            element.closest('.form-group').append(error);
        },
        highlight: function (element, errorClass, validClass) {
            $(element).addClass('is-invalid');
        },
        unhighlight: function (element, errorClass, validClass) {
            $(element).removeClass('is-invalid');
        }
    });

    // xu ly logic
    const formRegisterEl = document.getElementById("form-register")
    const userNameEl = document.getElementById("userName")
    const emailEl = document.getElementById("email")
    const passwordEl = document.getElementById("password")
    const confirmPasswordEl = document.getElementById("confirmPassword")

    formRegisterEl.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!$('#form-register').valid()) {
            return;
        }

        const data = {
            name: userNameEl.value,
            email: emailEl.value,
            password: passwordEl.value,
            confirmPassword: confirmPasswordEl.value
        }

        try {
            let res = await axios.post("/api/auth/register", data)
            toastr.success("Đăng ký thành công, vui lòng đăng nhập lại")
            setTimeout(() => {
                window.location.href = "/dang-nhap";
            }, 1000)
        } catch (error) {
            console.log(error)
            toastr.error(error.response.data.message)
        }
    })
</script>
</body>
</html>